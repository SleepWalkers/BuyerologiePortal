<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yunjee.common.dao.SPUDao">
    <resultMap id="SPUMap" type="SPU" >
		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="en_name" property="enName" jdbcType="VARCHAR" />
		<result column="zh_name" property="zhName" jdbcType="VARCHAR" />
		<result column="aliases" property="aliases" jdbcType="VARCHAR" />
		<result column="main_pic" property="mainPic" jdbcType="VARCHAR" />
		<result column="thumb_pic_of_list" property="thumbPicOfList" jdbcType="VARCHAR" />
		<result column="thumb_pic_of_brand" property="thumbPicOfBrand" jdbcType="VARCHAR" />
		<result column="thumb_pic_of_people" property="thumbPicOfPeople" jdbcType="VARCHAR" />
	    <result column="before_scent_disc" property="beforeScentDisc" jdbcType="LONGVARCHAR"/>
	    <result column="medium_scent_disc" property="mediumScentDisc" jdbcType="LONGVARCHAR"/>
	    <result column="after_scent_disc" property="afterScentDisc" jdbcType="LONGVARCHAR"/>		
		<result column="rate" property="rate" jdbcType="DOUBLE" />
		<result column="scent_total_id" property="scentTotalId" jdbcType="BIGINT" />
		<result column="sex_type" property="sexType" jdbcType="VARCHAR" />
		<result column="brand_id" property="brandId" jdbcType="BIGINT" />
		<result column="market_time" property="marketTime" jdbcType="VARCHAR" />
		<result column="liked_num" property="likedNum" jdbcType="INTEGER" />
		<result column="used_num" property="usedNum" jdbcType="INTEGER" />
		<result column="summary" property="summary" jdbcType="LONGVARCHAR"/>
		<result column="other_pics" property="otherPics" jdbcType="VARCHAR" />
		<result column="scent_type_id" property="scentTypeId" jdbcType="BIGINT" />
		<result column="pic_type" property="picType" jdbcType="BIT" />
		<result column="status" property="status" jdbcType="BIT" />
		<result column="out_line" property="outline" jdbcType="LONGVARCHAR"/>
		<result column="last_modify_date" property="lastModifyDate" jdbcType="VARCHAR" />
		<result column="comment_num" property="commentNum" jdbcType="INTEGER" />
		<result column="view_num" property="viewNum" jdbcType="INTEGER" />
		<result column="description" property="description" jdbcType="VARCHAR" />
		<result column="path_name" property="pathName" jdbcType="VARCHAR" />
	</resultMap>

	<insert id="insertSPU" parameterType="SPU" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO yunjee_spu
	      (en_name, zh_name, aliases, path_name, main_pic, thumb_pic_of_list, 
	      		thumb_pic_of_brand, thumb_pic_of_people, other_pics, pic_type,
	      		brand_id, market_time, scent_total_id, sex_type, before_scent_disc,
	      		medium_scent_disc, after_scent_disc, rate, liked_num , used_num,
	      		scent_type_id, summary, status, comment_num, view_num, last_modify_date,
	      		description, out_line)
	    VALUES
	      (#{enName}, #{zhName}, #{aliases}, #{pathName}, #{mainPic},  #{thumbPicOfList}, 
	      		#{thumbPicOfBrand}, #{thumbPicOfPeople}, #{otherPics}, #{picType},
	      		#{brandId}, #{marketTime}, #{scentTotalId},#{sexType},  #{beforeScentDisc}, 
	      		#{mediumScentDisc}, #{afterScentDisc}, #{rate},#{likedNum}, #{usedNum}, 
	      		#{scentTypeId}, #{summary}, #{status},  #{commentNum}, #{viewNum}, #{lastModifyDate}, 
	      		#{description}, #{outline})
	</insert>
	
	<update id="updateSPU" parameterType="SPU">
    	UPDATE yunjee_spu 
    	<set>
      		<if test="enName != null">
    			en_name = #{enName},
	        </if>

      		<if test="zhName != null">
    			zh_name = #{zhName},
	        </if>

      		<if test="aliases != null">
    			aliases = #{aliases},
	        </if>

		    <if test="pathName != null">
    			path_name = #{pathName},
	        </if>

		   	<if test="mainPic != null">
    			main_pic = #{mainPic},
	        </if>

		    <if test="thumbPicOfList != null">
    			thumb_pic_of_list = #{thumbPicOfList},
	        </if>

		    <if test="thumbPicOfBrand != null">
    			thumb_pic_of_brand = #{thumbPicOfBrand},
	        </if>
	        
		    <if test="thumbPicOfPeople != null">
    			thumb_pic_of_people = #{thumbPicOfPeople},
	        </if>

		    <if test="otherPics != null">
    			other_pics = #{otherPics},
	        </if>

      		<if test="picType != null">
    			pic_type = #{picType},
	        </if>

      		<if test="brandId != null">
    			brand_id = #{brandId},
	        </if>

		    <if test="marketTime != null">
    			market_time = #{marketTime},
	        </if>

		    <if test="scentTotalId != null">
    			scent_total_id = #{scentTotalId},
	        </if>
	        
		    <if test="sexType != null">
    			sex_type = #{sexType},
	        </if>
	        
		    <if test="beforeScentDisc != null">
    			before_scent_disc = #{beforeScentDisc},
	        </if>

		    <if test="mediumScentDisc != null">
    			medium_scent_disc = #{mediumScentDisc},
	        </if>

		    <if test="afterScentDisc != null">
    			after_scent_disc = #{afterScentDisc},
	        </if>

      		<if test="rate != null">
    			rate = #{rate},
	        </if>

      		<if test="likedNum != null">
    			liked_num = #{likedNum},
	        </if>
	        
		    <if test="usedNum != null">
    			used_num = #{usedNum},
	        </if>

		    <if test="scentTypeId != null">
    			scent_type_id = #{scentTypeId},
	        </if>

		    <if test="summary != null">
    			summary = #{summary},
	        </if>

		    <if test="status != null">
    			status = #{status},
	        </if>

		    <if test="commentNum != null">
    			comment_num = #{commentNum},
	        </if>

		    <if test="viewNum != null">
    			view_num = #{viewNum},
	        </if>
	        
      		<if test="lastModifyDate != null">
    			last_modify_date = #{lastModifyDate},
	        </if>
	        
      		<if test="description != null">
    			description = #{description},
	        </if>

		    <if test="outline != null">
    			out_line = #{outline}
	        </if>
	    </set>    
    	WHERE id = #{id}
    </update>
    
    <delete id="deleteById" parameterType="int">
    	DELETE FROM yunjee_spu where id = #{id}
    </delete>

    <delete id="deleteBySPU" parameterType="SPU">
    	DELETE 
    	FROM yunjee_spu 
		<trim prefix="WHERE" prefixOverrides="AND|OR">
      		<if test="enName != null">
    			en_name = #{enName}
	        </if>

      		<if test="zhName != null">
    			AND zh_name = #{zhName}
	        </if>

      		<if test="aliases != null">
    			AND aliases = #{aliases}
	        </if>

		    <if test="pathName != null">
    			AND path_name = #{pathName}
	        </if>

		   	<if test="mainPic != null">
    			AND main_pic = #{mainPic}
	        </if>

		    <if test="thumbPicOfList != null">
    			AND thumb_pic_of_list = #{thumbPicOfList}
	        </if>

		    <if test="thumbPicOfBrand != null">
    			AND thumb_pic_of_brand = #{thumbPicOfBrand}
	        </if>
	        
		    <if test="thumbPicOfPeople != null">
    			AND thumb_pic_of_people = #{thumbPicOfPeople}
	        </if>

		    <if test="otherPics != null">
    			AND other_pics = #{otherPics}
	        </if>

      		<if test="picType != null">
    			AND pic_type = #{picType}
	        </if>

      		<if test="brandId != null">
    			AND brand_id = #{brandId}
	        </if>

		    <if test="marketTime != null">
    			AND market_time = #{marketTime}
	        </if>

		    <if test="scentTotalId != null">
    			AND scent_total_id = #{scentTotalId}
	        </if>
	        
		    <if test="sexType != null">
    			AND sex_type = #{sexType}
	        </if>
	        
		    <if test="beforeScentDisc != null">
    			AND before_scent_disc = #{beforeScentDisc}
	        </if>

		    <if test="mediumScentDisc != null">
    			AND medium_scent_disc = #{mediumScentDisc}
	        </if>

		    <if test="afterScentDisc != null">
    			AND after_scent_disc = #{afterScentDisc}
	        </if>

      		<if test="rate != null">
    			AND rate = #{rate}
	        </if>

      		<if test="likedNum != null">
    			AND liked_num = #{likedNum}
	        </if>
	        
		    <if test="usedNum != null">
    			AND used_num = #{usedNum}
	        </if>

		    <if test="scentTypeId != null">
    			AND scent_type_id = #{scentTypeId}
	        </if>

		    <if test="summary != null">
    			AND summary = #{summary}
	        </if>

		    <if test="status != null">
    			AND status = #{status}
	        </if>

		    <if test="commentNum != null">
    			AND comment_num = #{commentNum}
	        </if>

		    <if test="viewNum != null">
    			AND view_num = #{viewNum}
	        </if>
	        
      		<if test="lastModifyDate != null">
    			AND last_modify_date = #{lastModifyDate}
	        </if>
	        
      		<if test="description != null">
    			AND description = #{description}
	        </if>

		    <if test="outline != null">
    			AND out_line = #{outline}
	        </if>	
	        	OR ID = 0	
		</trim>
    </delete>
        
    <select id="countById" parameterType="int" resultType="int">
    	select count(*)
    	from yunjee_spu
    	where id = #{id}
    </select>
    
    <select id="countBySPU" parameterType="SPU" resultType="int">
    	select count(*)
    	from yunjee_spu
    	<trim prefix="WHERE" prefixOverrides="AND|OR">
      		<if test="enName != null">
    			en_name = #{enName}
	        </if>

      		<if test="zhName != null">
    			AND zh_name = #{zhName}
	        </if>

      		<if test="aliases != null">
    			AND aliases = #{aliases}
	        </if>

		    <if test="pathName != null">
    			AND path_name = #{pathName}
	        </if>

		   	<if test="mainPic != null">
    			AND main_pic = #{mainPic}
	        </if>

		    <if test="thumbPicOfList != null">
    			AND thumb_pic_of_list = #{thumbPicOfList}
	        </if>

		    <if test="thumbPicOfBrand != null">
    			AND thumb_pic_of_brand = #{thumbPicOfBrand}
	        </if>
	        
		    <if test="thumbPicOfPeople != null">
    			AND thumb_pic_of_people = #{thumbPicOfPeople}
	        </if>

		    <if test="otherPics != null">
    			AND other_pics = #{otherPics}
	        </if>

      		<if test="picType != null">
    			AND pic_type = #{picType}
	        </if>

      		<if test="brandId != null">
    			AND brand_id = #{brandId}
	        </if>

		    <if test="marketTime != null">
    			AND market_time = #{marketTime}
	        </if>

		    <if test="scentTotalId != null">
    			AND scent_total_id = #{scentTotalId}
	        </if>
	        
		    <if test="sexType != null">
    			AND sex_type = #{sexType}
	        </if>
	        
		    <if test="beforeScentDisc != null">
    			AND before_scent_disc = #{beforeScentDisc}
	        </if>

		    <if test="mediumScentDisc != null">
    			AND medium_scent_disc = #{mediumScentDisc}
	        </if>

		    <if test="afterScentDisc != null">
    			AND after_scent_disc = #{afterScentDisc}
	        </if>

      		<if test="rate != null">
    			AND rate = #{rate}
	        </if>

      		<if test="likedNum != null">
    			AND liked_num = #{likedNum}
	        </if>
	        
		    <if test="usedNum != null">
    			AND used_num = #{usedNum}
	        </if>

		    <if test="scentTypeId != null">
    			AND scent_type_id = #{scentTypeId}
	        </if>

		    <if test="summary != null">
    			AND summary = #{summary}
	        </if>

		    <if test="status != null">
    			AND status = #{status}
	        </if>

		    <if test="commentNum != null">
    			AND comment_num = #{commentNum}
	        </if>

		    <if test="viewNum != null">
    			AND view_num = #{viewNum}
	        </if>
	        
      		<if test="lastModifyDate != null">
    			AND last_modify_date = #{lastModifyDate}
	        </if>
	        
      		<if test="description != null">
    			AND description = #{description}
	        </if>

		    <if test="outline != null">
    			AND out_line = #{outline}
	        </if>
	    </trim>
    </select>
    
    <select id="selectById" parameterType="int" resultMap="SPUMap">
    	SELECT * FROM yunjee_spu WHERE id = #{id}
    </select>
    
    <select id="selectByCreatorIdFromComment" parameterType="int" resultMap="SPUMap">
    	select * 
    	from yunjee_spu
    	where id in (
    		select distinct spu_id 
    		from yunjee_comment
    		where creator_id = #{creatorId})
    </select>
    
    <select id="selectByTypeAndUserId" parameterType="map" resultMap="SPUMap">
    	select * 
    	from yunjee_spu
    	where status = 1 and id in (
    		select spu_id 
    		from yunjee_r_user_spu
    		where type = #{type} and user_id = #{userId})    
    </select>
    
    <select id="selectBySexTypeWithLimit" parameterType="map" resultMap="SPUMap">
		SELECT *
		FROM yunjee_spu
    	where status = 1 AND sex_type = #{sexType}
        <if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>    
    
    </select>
    
    <select id="selectBySpuIdListOrderByRateWithLimit" parameterType="map" resultMap="SPUMap">
		SELECT *
		FROM yunjee_spu
    	where id in (${idList}) AND status = 1
        ORDER BY rate desc
        
        <if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>    
    </select>
    
    <select id="selectByBrandIdOrderByLikedNum" parameterType="map" resultMap="SPUMap">
    	select * 
    	from yunjee_spu
    	where brand_id = #{brandId} and status = 1
    	order by liked_num desc
    	limit #{start}, #{limit}
    </select>
    
    <select id="selectByBrandIdWithLimit" parameterType="map" resultMap="SPUMap">
    	SELECT *
		FROM yunjee_spu
		where brand_id = #{brandId} and status = 1
		<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
    
    <select id="selectByBrandIdOrderByRateWithLimit" parameterType="map" resultMap="SPUMap">
      	SELECT *
		FROM yunjee_spu
		where brand_id = #{brandId} and status = 1
		order by rate desc
		<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>  
    </select>
    
    <select id="selectByBrandIdOrderByLikedNumWithLimit" parameterType="map" resultMap="SPUMap">
       	SELECT *
		FROM yunjee_spu
		where brand_id = #{brandId} and status = 1
		order by liked_num desc
		<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>     
    </select>
    
	<select id="selectByParametersWithLimit" parameterType="SQLParameters" resultMap="SPUMap">
		SELECT *
		FROM yunjee_spu
    	<where>
    		<if test="brandId != null">
    			brand_id = #{brandId}
	        </if>	
    		
    		<if test="idList != null">
    			AND id in (${idList})
    		</if>
    		
    		<if test="status != null">
    			AND status = #{status}
	        </if>
	        
	        <if test="sexType != null">
    			AND sex_type = #{sexType}
	        </if>
    	</where>
	        
        <if test="orderBy != null">
        	ORDER BY ${orderBy}
        </if>
        
        <if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
	</select>
	
	<select id="selectPicIsNull" resultMap="SPUMap">
		select * 
		from yunjee_spu 
		where main_pic is null || thumb_pic_of_list is null || thumb_pic_of_brand is null || thumb_pic_of_people is null
	</select>
	
	<select id="selectScentDescIsNull" resultMap="SPUMap">
		select * 
		from yunjee_spu 
		where before_scent_disc is null || medium_scent_disc is null || after_scent_disc is null
	</select>
	
	<select id="selectSummaryIsNull" resultMap="SPUMap">
		select * 
		from yunjee_spu 
		where summary is null || description is null
	</select>
	
    <select id="selectBySPU" parameterType="SPU" resultMap="SPUMap">
    	SELECT * 
    	FROM yunjee_spu
		<trim prefix="WHERE" prefixOverrides="AND|OR">
      		<if test="enName != null">
    			en_name = #{enName}
	        </if>

      		<if test="zhName != null">
    			AND zh_name = #{zhName}
	        </if>

      		<if test="aliases != null">
    			AND aliases = #{aliases}
	        </if>

		    <if test="pathName != null">
    			AND path_name = #{pathName}
	        </if>

		   	<if test="mainPic != null">
    			AND main_pic = #{mainPic}
	        </if>

		    <if test="thumbPicOfList != null">
    			AND thumb_pic_of_list = #{thumbPicOfList}
	        </if>

		    <if test="thumbPicOfBrand != null">
    			AND thumb_pic_of_brand = #{thumbPicOfBrand}
	        </if>
	        
		    <if test="thumbPicOfPeople != null">
    			AND thumb_pic_of_people = #{thumbPicOfPeople}
	        </if>

		    <if test="otherPics != null">
    			AND other_pics = #{otherPics}
	        </if>

      		<if test="picType != null">
    			AND pic_type = #{picType}
	        </if>

      		<if test="brandId != null">
    			AND brand_id = #{brandId}
	        </if>

		    <if test="marketTime != null">
    			AND market_time = #{marketTime}
	        </if>

		    <if test="scentTotalId != null">
    			AND scent_total_id = #{scentTotalId}
	        </if>
	        
		    <if test="sexType != null">
    			AND sex_type = #{sexType}
	        </if>
	        
		    <if test="beforeScentDisc != null">
    			AND before_scent_disc = #{beforeScentDisc}
	        </if>

		    <if test="mediumScentDisc != null">
    			AND medium_scent_disc = #{mediumScentDisc}
	        </if>

		    <if test="afterScentDisc != null">
    			AND after_scent_disc = #{afterScentDisc}
	        </if>

      		<if test="rate != null">
    			AND rate = #{rate}
	        </if>

      		<if test="likedNum != null">
    			AND liked_num = #{likedNum}
	        </if>
	        
		    <if test="usedNum != null">
    			AND used_num = #{usedNum}
	        </if>

		    <if test="scentTypeId != null">
    			AND scent_type_id = #{scentTypeId}
	        </if>

		    <if test="summary != null">
    			AND summary = #{summary}
	        </if>

		    <if test="status != null">
    			AND status = #{status}
	        </if>

		    <if test="commentNum != null">
    			AND comment_num = #{commentNum}
	        </if>

		    <if test="viewNum != null">
    			AND view_num = #{viewNum}
	        </if>
	        
      		<if test="lastModifyDate != null">
    			AND last_modify_date = #{lastModifyDate}
	        </if>
	        
      		<if test="description != null">
    			AND description = #{description}
	        </if>

		    <if test="outline != null">
    			AND out_line = #{outline}
	        </if>	
		</trim>
    </select>
</mapper>