<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yunjee.common.dao.CommentDao">
  	<resultMap id="CommentMap" type="Comment" >
	    <id column="id" property="id" jdbcType="BIGINT" />
	    <result column="creator_id" property="creatorId" jdbcType="BIGINT" />
	    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
	    <result column="type" property="type" jdbcType="VARCHAR" />
	    <result column="liked_num" property="likedNum" jdbcType="INTEGER" />
	    <result column="content" property="content" jdbcType="LONGVARCHAR"/>
	    <result column="status" property="status" jdbcType="INTEGER" />
	    <result column="spu_id" property="spuId" jdbcType="BIGINT" />
	    <result column="title" property="title" jdbcType="VARCHAR" />
	    <result column="come_from" property="comeFrom" jdbcType="VARCHAR" />
	    <result column="thumbnail" property="thumbnail" jdbcType="VARCHAR" />
	    <result column="summary" property="summary" jdbcType="LONGVARCHAR"/>
	    <result column="hot" property="hot" jdbcType="INTEGER" />
  	</resultMap>
  	
	<insert id="insertComment" parameterType="Comment" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO yunjee_comment
	      (creator_id, create_date, type, liked_num, content, status, 
	      		spu_id, title, come_from, thumbnail, summary, hot)
	    VALUES
	      (#{creatorId}, #{createDate}, #{type}, #{likedNum}, #{content},  #{status}, 
	      		#{spuId}, #{title}, #{comeFrom}, #{thumbnail}, #{summary}, #{hot})
	</insert>
	
	<update id="updateComment" parameterType="Comment">
    	UPDATE yunjee_comment 
    	<set>
      		<if test="spuId != null">
    			spu_id = #{spuId},
	        </if>
	        
      		<if test="title != null">
    			title = #{title},
	        </if>

      		<if test="content != null">
    			content = #{content},
	        </if>

		    <if test="summary != null">
    			summary = #{summary},
	        </if>

		    <if test="thumbnail != null">
    			thumbnail = #{thumbnail},
	        </if>

		    <if test="type != null">
    			type = #{type},
	        </if>

		    <if test="creatorId != null">
    			creator_id = #{creatorId},
	        </if>

		    <if test="createDate != null">
    			create_date = #{createDate},
	        </if>

		    <if test="comeFrom != null">
    			come_from = #{comeFrom},
	        </if>

		    <if test="likedNum != null">
    			liked_num = #{likedNum},
	        </if>

		    <if test="hot != null">
    			hot = #{hot},
	        </if>

		    <if test="status != null">
    			status = #{status}
	        </if>
		</set>
    	WHERE id = #{id}
    </update>
    
    <delete id="deleteById" parameterType="int">
    	DELETE FROM yunjee_comment where id = #{id}
    </delete>
    
    <delete id="deleteByComment" parameterType="Comment">
    	DELETE
    	FROM yunjee_comment
    	<trim prefix="WHERE" prefixOverrides="AND|OR">
       		<if test="spuId != null">
    			spu_id = #{spuId}
	        </if>
	        
      		<if test="title != null">
    			AND title = #{title}
	        </if>

      		<if test="content != null">
    			AND content = #{content}
	        </if>

		    <if test="summary != null">
    			AND summary = #{summary}
	        </if>

		    <if test="thumbnail != null">
    			AND thumbnail = #{thumbnail}
	        </if>

		    <if test="type != null">
    			AND type = #{type}
	        </if>

		    <if test="creatorId != null">
    			AND creator_id = #{creatorId}
	        </if>

		    <if test="createDate != null">
    			AND create_date = #{createDate}
	        </if>

		    <if test="comeFrom != null">
    			AND come_from = #{comeFrom}
	        </if>

		    <if test="likedNum != null">
    			AND liked_num = #{likedNum}
	        </if>

		    <if test="hot != null">
    			AND hot = #{hot}
	        </if>

		    <if test="status != null">
    			AND status = #{status}
	        </if>
	        	OR ID = 0  	
    	</trim>
    </delete>

    <select id="selectById" parameterType="int" resultMap="CommentMap">
    	SELECT * FROM yunjee_comment WHERE id = #{id}
    </select>
    
    <select id="countByComment" parameterType="Comment" resultType="int">
    	select count(*) 
    	from yunjee_comment
    	<trim prefix="WHERE" prefixOverrides="AND|OR">
       		<if test="spuId != null">
    			spu_id = #{spuId}
	        </if>
	        
      		<if test="title != null">
    			AND title = #{title}
	        </if>

      		<if test="content != null">
    			AND content = #{content}
	        </if>

		    <if test="summary != null">
    			AND summary = #{summary}
	        </if>

		    <if test="thumbnail != null">
    			AND thumbnail = #{thumbnail}
	        </if>

		    <if test="type != null">
    			AND type = #{type}
	        </if>

		    <if test="creatorId != null">
    			AND creator_id = #{creatorId}
	        </if>

		    <if test="createDate != null">
    			AND create_date = #{createDate}
	        </if>

		    <if test="comeFrom != null">
    			AND come_from = #{comeFrom}
	        </if>

		    <if test="likedNum != null">
    			AND liked_num = #{likedNum}
	        </if>

		    <if test="hot != null">
    			AND hot = #{hot}
	        </if>

		    <if test="status != null">
    			AND status = #{status}
	        </if>
    	</trim>    
    </select>
    
    <select id="selectByUserIdOrderByCreateDateWithLimit" parameterType="map" resultMap="CommentMap">
    	select * 
    	from yunjee_comment
    	where creator_id = #{userId}
    	order by create_date desc
    	<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
    
    <select id="selectBySpuIdOrderByCreateDateWithLimit" parameterType="map" resultMap="CommentMap">
    	select * 
    	from yunjee_comment 
    	<where>
    		status = 1
    		<if test="spuId != null">
    			AND spu_id = #{spuId}
    		</if>
    	</where>
        order by create_date desc
    	<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
    
    <select id="selectBySpuIdWithLimit" parameterType="map" resultMap="CommentMap">
    	select * 
    	from yunjee_comment 
    	<where>
    		status = 1
    		<if test="spuId != null">
    			AND spu_id = #{spuId}
    		</if>
    	</where>
    	
    	<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
    
    <select id="selectBySpuIdOrderByHotWithLimit" parameterType="map" resultMap="CommentMap">
    	select * 
    	from yunjee_comment 
    	<where>
    		status = 1
    		<if test="spuId != null">
    			AND spu_id = #{spuId}
    		</if>
    	</where>
        order by hot desc,liked_num desc
    	<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
    
    
    <select id="selectByUserIdOrderByHotWithLimit" parameterType="map" resultMap="CommentMap">
    	select * 
    	from yunjee_comment 
    	<where>
    		status = 1
    		<if test="spuId != null">
    			AND spu_id = #{spuId}
    		</if>
    	</where>
        order by hot desc,liked_num desc
    	<if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
    
    <select id="selectByParameter" parameterType="SQLParameters" resultMap="CommentMap">
    	select *
    	from yunjee_comment
    	<where>
    		<if test="spuId != null">
    			status = 1 AND spu_id = #{spuId}
    		</if>
    	
    		<if test="userId != null">
    			creator_id = #{userId}
    		</if>
    	</where>
    	
   	    <if test="orderBy != null">
   			order by ${orderBy}
   		</if>
   	
        <if test="start != null">
        	<if test="limit != null">
        		limit ${start},${limit}    
        	</if>
        </if>
   	
   		<if test="start == null">
   			<if test="limit != null">
   				limit ${limit}
   			</if>
   		</if>
    </select>
        
    <select id="countByStatusAndCreatorId" parameterType="int" resultType="int">
    	select count(*) 
    	from yunjee_comment
    	where status = 1 and creator_id = #{creatorId}
    </select>
    
    <select id="selectByComment" parameterType="Comment" resultMap="CommentMap">
    	SELECT *
    	FROM yunjee_comment
    	<trim prefix="WHERE" prefixOverrides="AND|OR">
       		<if test="spuId != null">
    			spu_id = #{spuId}
	        </if>
	        
      		<if test="title != null">
    			AND title = #{title}
	        </if>

      		<if test="content != null">
    			AND content = #{content}
	        </if>

		    <if test="summary != null">
    			AND summary = #{summary}
	        </if>

		    <if test="thumbnail != null">
    			AND thumbnail = #{thumbnail}
	        </if>

		    <if test="type != null">
    			AND type = #{type}
	        </if>

		    <if test="creatorId != null">
    			AND creator_id = #{creatorId}
	        </if>

		    <if test="createDate != null">
    			AND create_date = #{createDate}
	        </if>

		    <if test="comeFrom != null">
    			AND come_from = #{comeFrom}
	        </if>

		    <if test="likedNum != null">
    			AND liked_num = #{likedNum}
	        </if>

		    <if test="hot != null">
    			AND hot = #{hot}
	        </if>

		    <if test="status != null">
    			AND status = #{status}
	        </if>
    	</trim>    	
    </select>
</mapper>